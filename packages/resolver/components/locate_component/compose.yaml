compose:
  - call: lcod://tooling/value/default_object@0.1.0
    in:
      value: $.options
    out:
      options: resolved
  - call: lcod://tooling/value/default_object@0.1.0
    in:
      value: $.options.paths
    out:
      pathOptions: resolved
  - call: lcod://tooling/value/default_object@0.1.0
    in:
      value: $.options.cache
    out:
      cacheOptions: resolved
  - call: lcod://tooling/value/default_array@0.1.0
    in:
      value: $.options.registrySources
    out:
      extraRegistrySources: resolved
  - call: lcod://resolver/internal/resolve_paths@0.1.0
    in:
      refererPath: $.pathOptions.refererPath
      pathOptions: $.pathOptions
      cacheOptions: $.cacheOptions
    out:
      resolvedPaths: resolvedPaths
  - call: lcod://resolver/internal/find_local_component@0.1.0
    in:
      componentId: $.componentId
      componentsRoot: $.resolvedPaths.componentsRoot
      componentsRegistryPath: $.resolvedPaths.componentsRegistryPath
    out:
      localFound: found
      localResult: result
      localWarnings: warnings
  - call: lcod://flow/if@1
    in:
      cond: $.localFound
    out:
      finalFound: finalFound
      finalResult: finalResult
      finalWarnings: finalWarnings
    slots:
      then:
        - call: lcod://tooling/value/default_array@0.1.0
          in:
            value: $.localWarnings
          out:
            localWarningsNormalized: resolved
        - call: lcod://impl/set@1
          in:
            finalFound: true
            finalResult: $.localResult
            finalWarnings: $.localWarningsNormalized
          out:
            finalFound: finalFound
            finalResult: finalResult
            finalWarnings: finalWarnings
      else:
        - call: lcod://resolver/internal/parse_component_id@0.1.0
          in:
            componentId: $.componentId
          out:
            parsedValid: valid
            parsedPathParts: pathParts
            parsedNamespace: namespace
            parsedVersion: version
        - call: lcod://resolver/internal/spec_lookup@0.1.0
          in:
            componentId: $.componentId
            pathParts: $.parsedPathParts
            specRoot: $.resolvedPaths.specRoot
            resolverRoot: $.resolvedPaths.resolverRoot
          out:
            specLookupFound: found
            specLookupResult: result
            specLookupWarningsRaw: warnings
        - call: lcod://tooling/value/default_array@0.1.0
          in:
            value: $.specLookupWarningsRaw
          out:
            specLookupWarnings: resolved
        - call: lcod://flow/if@1
          in:
            cond: $.specLookupFound
          out:
            finalResult: finalResult
            finalFound: finalFound
            finalWarnings: finalWarnings
          slots:
            then:
              - call: lcod://impl/set@1
                in:
                  finalFound: true
                  finalResult: $.specLookupResult
                  finalWarnings: $.specLookupWarnings
                out:
                  finalFound: finalFound
                  finalResult: finalResult
                  finalWarnings: finalWarnings
            else:
              - call: lcod://resolver/internal/build_sources_spec@0.1.0
                in:
                  cataloguePath: $.resolvedPaths.cataloguePath
                  extraSources: $.extraRegistrySources
                out:
                  generatedSources: sources
                  sourcesSpec: sourcesSpec
              - call: lcod://tooling/registry_sources/resolve@0.1.0
                in:
                  projectPath: $.resolvedPaths.projectRoot
                  cacheDir: $.resolvedPaths.projectCacheDir
                  sourcesPath: $.pathOptions.sourcesPath
                  defaultSourcesSpec: $.sourcesSpec
                  cwd: $.resolvedPaths.cwd
                out:
                  registrySources: registrySources
                  warnings: resolveWarnings
              - call: lcod://tooling/registry/index@0.1.0
                in:
                  sources: $.registrySources
                out:
                  registryEntries: registryEntries
                  registryPackages: registryPackages
                  registryRegistries: registryRegistries
                  indexWarnings: indexWarnings
              - call: lcod://tooling/value/default_array@0.1.0
                in:
                  value: $.registryEntries
                out:
                  registryEntriesList: resolved
              - call: lcod://tooling/value/is_string_nonempty@0.1.0
                in:
                  value: $.componentId
                out:
                  componentIdValid: componentIdValid
              - call: lcod://flow/foreach@1
                in:
                  list: $.registryEntriesList
                  collectPath: $.matches
                out:
                  matches: results
                slots:
                  body:
                    - call: lcod://tooling/value/is_object@0.1.0
                      in:
                        value: $slot.item
                      out:
                        entryIsObject: ok
                    - call: lcod://flow/if@1
                      in:
                        cond: $.entryIsObject
                      out:
                        match: match
                      slots:
                        then:
                          - call: lcod://tooling/value/is_string_nonempty@0.1.0
                            in:
                              value: $slot.item.id
                            out:
                              entryHasId: ok
                          - call: lcod://tooling/value/is_object@0.1.0
                            in:
                              value: $slot.item.compose
                            out:
                              composeIsObject: ok
                          - call: lcod://tooling/value.deep_equal@0.1.0
                            in:
                              left: $slot.item.id
                              right: $.componentId
                            out:
                              idCompare: result
                          - call: lcod://flow/if@1
                            in:
                              cond: $.componentIdValid
                            out:
                              match: match
                            slots:
                              then:
                                - call: lcod://flow/if@1
                                  in:
                                    cond: $.entryHasId
                                  out:
                                    match: match
                                  slots:
                                    then:
                                      - call: lcod://flow/if@1
                                        in:
                                          cond: $.idCompare.equal
                                        out:
                                          match: match
                                        slots:
                                          then:
                                            - call: lcod://flow/if@1
                                              in:
                                                cond: $.composeIsObject
                                              out:
                                                match: match
                                              slots:
                                                then:
                                                  - call: lcod://impl/set@1
                                                    in:
                                                      match: $slot.item
                                                    out:
                                                      match: match
                                                else:
                                                  - call: lcod://impl/set@1
                                                    in:
                                                      match: null
                                                    out:
                                                      match: match
                                          else:
                                            - call: lcod://impl/set@1
                                              in:
                                                match: null
                                              out:
                                                match: match
                                    else:
                                      - call: lcod://impl/set@1
                                        in:
                                          match: null
                                        out:
                                          match: match
                              else:
                                - call: lcod://impl/set@1
                                  in:
                                    match: null
                                  out:
                                    match: match
                        else:
                          - call: lcod://impl/set@1
                            in:
                              match: null
                            out:
                              match: match
              - call: lcod://tooling/value/default_array@0.1.0
                in:
                  value: $.matches
                out:
                  matches: resolved
              - call: lcod://tooling/value/is_object@0.1.0
                in:
                  value: $.matches[0]
                out:
                  firstMatchIsObject: ok
              - call: lcod://tooling/value/default_array@0.1.0
                in:
                  value: $.resolveWarnings
                out:
                  resolveWarningsArray: resolved
              - call: lcod://tooling/value/default_array@0.1.0
                in:
                  value: $.indexWarnings
                out:
                  indexWarningsArray: resolved
              - call: lcod://tooling/array/append@0.1.0
                in:
                  items: $.resolveWarningsArray
                  values: $.indexWarningsArray
                out:
                  aggregatedWarnings: items
              - call: lcod://tooling/array/append@0.1.0
                in:
                  items: $.specLookupWarnings
                  values: $.aggregatedWarnings
                out:
                  aggregatedWarningsWithSpec: items
              - call: lcod://flow/if@1
                in:
                  cond: $.firstMatchIsObject
                out:
                  finalResult: finalResult
                  finalFound: finalFound
                  finalWarnings: finalWarnings
                slots:
                  then:
                    - call: lcod://impl/set@1
                      in:
                        finalFound: true
                        finalResult: $.matches[0]
                        finalWarnings: $.aggregatedWarningsWithSpec
                      out:
                        finalFound: finalFound
                        finalResult: finalResult
                        finalWarnings: finalWarnings
                  else:
                    - call: lcod://impl/set@1
                      in:
                        finalFound: false
                        finalResult: null
                        finalWarnings: $.aggregatedWarningsWithSpec
                      out:
                        finalFound: finalFound
                        finalResult: finalResult
                        finalWarnings: finalWarnings
  - call: lcod://tooling/value/default_array@0.1.0
    in:
      value: $.finalWarnings
    out:
      finalWarnings: resolved
  - call: lcod://impl/set@1
    in:
      found: $.finalFound
      result: $.finalResult
      warnings: $.finalWarnings
    out:
      found: found
      result: result
      warnings: warnings
